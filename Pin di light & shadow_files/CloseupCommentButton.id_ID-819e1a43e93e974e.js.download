"use strict";(self.legacyJsonp=self.legacyJsonp||[]).push([["8419"],{507203:function(e,n,t){t.r(n);var o={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"CloseupCommentButton_pin",selections:[{alias:null,args:null,kind:"ScalarField",name:"commentsDisabled",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"isEligibleForPdp",storageKey:null},{args:null,kind:"FragmentSpread",name:"CommentsPopover_pin"}],type:"Pin",abstractKey:null};o.hash="526d11c356c26ad0b89c7990a8828b3a",n.default=o},20262:function(e,n,t){t.r(n),t.d(n,{default:function(){return b}});var o,r=t(586659);t(872555);var i=t(20256),l=t(934645),a=t(980787),s=t(28427),c=t(19585),u=t(709311),d=t(941404),m=t(601686),p=t(230543),f=t(78762),v=t(382718);function g(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,o=Array(n);t<n;t++)o[t]=e[t];return o}var h=(0,f.Z)(function(){return t.e("30233").then(t.bind(t,210238))},void 0,function(e){return 210238},"CommentsPopover",function(e){return ["30233"]}),y=(void 0!==o||(o=t(507203)).hash&&"526d11c356c26ad0b89c7990a8828b3a"!==o.hash&&console.error("The definition of 'CloseupCommentButton_pin' appears to have changed. Run `relay-compiler` to update the generated files to receive the expected data."),o);function b(e){var n,t=e.inCommentsImprovedDropdownExp,o=e.inCommentsPopoverExp,f=e.isEligibleForAggregatedComments,b=e.pinKey,C=e.shouldShowCommentCount,w=e.totalCommentCount,x=e.viewParameter,_=e.viewType,E=e.scrollContainerRef,I=(0,c.Z)(),P=(0,p.t)(),T=(0,s.Z)(y,b),S=(0,l.Z)({showProductDetailPage:!!T.isEligibleForPdp}),j=(0,m.x4)(),R=j.isCommentThreadExpanded,k=j.setIsCommentThreadExpanded,A=j.setIsCommentComposerFocused,B=(0,a.u)().logContextEvent,F=(0,r.useRef)(null),D=function(e){if(Array.isArray(e))return e}(n=(0,r.useState)(!1))||function(e,n){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var o,r,i,l,a=[],s=!0,c=!1;try{for(i=(t=t.call(e)).next;!(s=(o=i.call(t)).done)&&(a.push(o.value),2!==a.length);s=!0);}catch(e){c=!0,r=e}finally{try{if(!s&&null!=t.return&&(l=t.return(),Object(l)!==l))return}finally{if(c)throw r}}return a}}(n,2)||function(e,n){if(e){if("string"==typeof e)return g(e,2);var t=({}).toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?g(e,2):void 0}}(n,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),L=D[0],K=D[1],Z=o&&R;(0,r.useEffect)(function(){if(S&&E){var e=document.getElementById("canonical-card");if(e){var n=new IntersectionObserver(function(e){var n=e[0];n&&K(n.isIntersecting)},{root:E,threshold:0});return n.observe(e),setTimeout(function(){var t=n.takeRecords();if(t.length>0&&t[0])K(t[0].isIntersecting);else{var o=E.getBoundingClientRect(),r=e.getBoundingClientRect();K(r.top>=o.top&&r.top<=o.bottom)}},100),function(){n.disconnect()}}}},[S,E]);var z=I.bt("Komentar", "Comments", "Closeup.Comment.Icon", undefined, true),O=function(e){B({component:13464,element:2,event_type:10554,view_parameter:x,view_type:_}),(0,d.tj)("dweb.closeup_comment_button.community_view_intent",{tags:{experimentGroup:t?"improved_dropdown":"popover",clickSource:e}})},J=function(e){var n=document.getElementById("canonical-card"),o=document.querySelector('[data-test-id="canonical-card-tap-area"]');if(n){if(S&&E){var r=E.getBoundingClientRect(),i=n.getBoundingClientRect().top-r.top,l=E.scrollTop+i-P,a=null,s=function n(){a&&clearTimeout(a),a=setTimeout(function(){t&&(null==k||k(!0),O(e)),o&&o.focus(),E.removeEventListener("scroll",n)},100)};E.addEventListener("scroll",s,{passive:!0}),s(),E.scrollTo({top:l,behavior:"smooth"});return}var c=n.getBoundingClientRect().top+window.scrollY-P,u=null,d=function n(){u&&clearTimeout(u),u=setTimeout(function(){t&&(null==k||k(!0),O(e)),o&&o.focus(),window.removeEventListener("scroll",n)},100)};window.addEventListener("scroll",d,{passive:!0}),d(),window.scrollTo({top:c,behavior:"smooth"})}},M=function(e){if(o)R?null==k||k(!1):(null==k||k(!0),O(e));else if(S){var n=w>0;if(!L)return void J(e);R||!n||null==k||k(!0),O(e),A(!0)}else J(e)};return(0,v.jsxs)(i.xu,{children:[Z&&(0,v.jsx)(h,{anchorRef:F,pinKey:T,setIsOpen:k,viewParameter:x}),(0,v.jsxs)(i.kC,{alignItems:"center",direction:"row",children:[(0,v.jsx)(i.hU,{ref:F,accessibilityLabel:z,disabled:!f||!!T.commentsDisabled,icon:"speech-outline",onClick:function(){return M("icon")},selected:Z,size:"lg",tooltip:{text:z}}),C&&(0,v.jsx)(i.iP,{disabled:!f||!!T.commentsDisabled,onTap:function(){return M("count")},children:(0,v.jsx)(i.xv,{weight:"bold",children:(0,v.jsx)(u.Z,{shortform:!0,shortformMaximumFractionDigits:1,value:w})})})]})]})}}}]);